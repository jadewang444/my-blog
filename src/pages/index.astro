---
import Base from "$layouts/Base.astro";
import { getCollection } from 'astro:content';
import Time from '$utils/time';

const allJottings = await getCollection('jotting');
const posts = allJottings
  .filter(p => !p.data.draft)
  .sort((a,b) => b.data.timestamp.getTime() - a.data.timestamp.getTime())
  .slice(0,3);
---

<Base title={"Home | Jade's Space"} locale={"en"}>
  <main class="cover container page">
    <div class="readable">
      <figure class="hero reveal">
        <img src="/me.png" alt="Hero — The Met" loading="lazy" decoding="async" />
        <figcaption class="meta">The Met, Nov 2025</figcaption>
      </figure>

      <div class="reveal" style="margin-top:1rem">
        <h1 class="tagline">I write and record<br/>to taste life twice.</h1>
        <div class="meta">New York • United States</div>
      </div>

      <section class="reveal" style="margin-top:1.5rem">
        <h2 style="margin-bottom:.6rem">Recent writing</h2>
        <div class="recent-grid">
          {posts.map(post => (
            <article class="card" aria-labelledby={post.id}>
              <h3 id={post.id} style="font-size:1.15rem">{post.data.title}</h3>
              <p>{post.data.description ?? post.body?.slice?.(0,120)}</p>
              <div class="meta" style="margin-top:.6rem">{Time.date.locale(post.data.timestamp)}</div>
            </article>
          ))}
        </div>
      </section>
    </div>

    <script>
      // Reveal animation on load (respect prefers-reduced-motion via CSS)
      if (typeof window !== 'undefined') {
        window.addEventListener('load', () => {
          document.querySelectorAll('.reveal').forEach(el => el.classList.add('show'));
        });
      }
    </script>
  </main>
</Base>

<style>
  /* Homepage-scoped adjustments so only the root index page is affected. */
  .home-cta { display:flex; flex-direction:column; align-items:center; gap:0.6rem; }

  /* Match the CTA sentence to `.quote-text` typography (font family, size, letter-spacing).
     Keep spacing tight: ~0.5–0.75rem gap between sentence and link. */
  .cta-matched {
    font-family: var(--font); /* same as .quote-text */
    font-size: var(--cover-text-size);
    letter-spacing: 0.003em;
    margin: 0; /* spacing controlled by gap on .home-cta */
    text-align: center;
  }

  /* Slightly smaller link under the sentence, visually balanced with the quote. */
  .cta-matched-link { font-size: calc(var(--cover-text-size) - 0.1rem); margin:0; }
</style>
