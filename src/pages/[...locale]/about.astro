---
import { i18n } from "astro:config/client";
import { getEntry } from "astro:content";
import Time from "$utils/time";
import Base from "$layouts/Base.astro";
import i18nit from "$i18n";
import { render } from "astro:content";

export async function getStaticPaths() {
	return i18n?.locales.map(locale => ({ params: { locale: locale == i18n?.defaultLocale ? undefined : (locale as string) } }));
}

const { locale = i18n!.defaultLocale } = Astro.params;

const t = i18nit(locale);

const introduction = await getEntry("information", `${locale}/introduction`);
const roll = await getEntry("information", `${locale}/roll`);
const chronicle = (await getEntry("information", `${locale}/chronicle`))?.data;

const { Content: Introduction } = introduction ? await render(introduction) : ({} as any);
const { Content: Roll } = roll ? await render(roll) : ({} as any);

const chronicles = Object.entries<string[]>(chronicle ?? {})
	.map(([date, events]) => ({ date: new Date(date), events: events ?? [] }))
	.sort((a, b) => b.date.getTime() - a.date.getTime());
---

<style lang="less">
	article {
		div {
			margin-bottom: 2rem;

			h1 {
				margin-bottom: 1rem;

				/* Make introduction/roll headings only slightly larger than body text */
				font-size: calc(var(--body-size) * 1.05);
				font-weight: 600;
			}
		}
	}
</style>

<Base title={t("navigation.about")} {locale}>
	<main class="flex flex-col">
		<article class="flex flex-col">
			{
				introduction && (
					<div>
						<h1>{t("about.introduction")}</h1>
						<samp class="markdown">
							<Introduction />
						</samp>
					</div>
				)
			}
		</article>
	</main>
</Base>
