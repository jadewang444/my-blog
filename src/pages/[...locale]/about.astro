---
import { i18n } from "astro:config/client";
import { getEntry } from "astro:content";
import Base from "$layouts/Base.astro";
import i18nit from "$i18n";
import { render } from "astro:content";

export async function getStaticPaths() {
	return i18n?.locales.map(locale => ({ params: { locale: locale == i18n?.defaultLocale ? undefined : (locale as string) } }));
}

const { locale = i18n!.defaultLocale } = Astro.params;

const t = i18nit(locale);

const introduction = await getEntry("information", `${locale}/introduction`);
// roll and chronicle removed â€” About page will only show the Introduction

const { Content: Introduction } = introduction ? await render(introduction) : ({} as any);
---

<style lang="less">
	article {
		div {
			margin-bottom: 2rem;

			h1 {
				margin-bottom: 1rem;

				/* Keep Introduction/Link Roll headings only slightly larger than body text, but not bold */
				font-size: calc(var(--body-size) * 1.05);
				font-weight: 400;
			}
		}

		/* Remove bold styling across the about page */
		/* Make content headings one size smaller than the Introduction/Link Roll (i.e., same as body) */
		.markdown {
			/* Ensure headings inside the rendered markdown are not bold and are one size smaller */
			h1, h2, h3, h4, h5, h6 {
				font-weight: 400;
				font-size: var(--body-size);
				margin-top: 0.75rem;
				margin-bottom: 0.5rem;
			}

			/* Remove bold from strong/b/bold classes inside markdown content */
			strong, b {
				font-weight: 400 !important;
				font-family: var(--font-body) !important;
			}

			/* Force all rendered markdown elements to normal weight and body font
			   This ensures any inline strong/b or utility classes don't appear bold */
			* {
				font-weight: 400 !important;
				font-family: var(--font-body) !important;
			}

			/* Also normalise emphasis if necessary */
			em {
				font-style: italic;
				font-weight: 400;
			}
		}

		/* Remove bold globally on the page (for any remaining elements) */
		strong, b {
			font-weight: 400;
		}


	}
</style>

<Base title={t("navigation.about")} {locale}>
	<main class="flex flex-col">
		<article class="flex flex-col">
			{
				introduction && (
					<div>
						<h1>{t("about.introduction")}</h1>
						<samp class="markdown">
							<Introduction />
						</samp>
					</div>
				)
			}
		</article>
	</main>

	<!-- Remove embedded links from rendered markdown by replacing <a> with <span> on DOMContentLoaded -->
	<script type="module">
		if (typeof window !== 'undefined') {
			document.addEventListener('DOMContentLoaded', () => {
				const nodes = document.querySelectorAll('.markdown a');
				for (const a of nodes) {
					try {
						const span = document.createElement('span');
						// copy text content and child nodes
						span.innerHTML = a.innerHTML;
						span.className = a.className || '';
						a.replaceWith(span);
					} catch (e) {
						// silently ignore
					}
				}
			});
		}
	</script>

	</Base>
