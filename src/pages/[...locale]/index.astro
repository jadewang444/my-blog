---
export const prerender = true;

import { i18n } from "astro:config/client";
import { render, getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
// ❌ import { Icon } from "astro-icon/components"; // 不再使用站点 logo
import Time from "$utils/time";
import Base from "$layouts/Base.astro";
import Heatmap from "$components/Heatmap.svelte";
import config from "$config";
import i18nit from "$i18n";

export async function getStaticPaths() {
  // Create path for each locale, omitting default locale from URL
  return i18n!.locales.map(locale => ({
    params: { locale: locale == i18n?.defaultLocale ? undefined : (locale as string) }
  }));
}

const { locale = i18n!.defaultLocale } = Astro.params;
const t = i18nit(locale);

// Preface（当前语言，按时间倒序）
const prefaces = (
  await getCollection("preface", preface => {
    const [language, id] = preface.id.split("/");
    preface.id = id;
    return language == locale;
  })
).sort((a, b) => b.data.timestamp.getTime() - a.data.timestamp.getTime());

// Notes removed from site — we no longer fetch the `note` collection for the homepage

// Jottings（已发布，当前语言）
const jottings = await getCollection("jotting", jotting => {
  const [language] = jotting.id.split("/");
  return !jotting.data.draft && language == locale;
});

const preface = prefaces[0];
const { Content } = preface ? await render(preface) : ({} as any);
// Localized URL for the "At Twenty-Five" jotting
const atTwentyFiveUrl = getRelativeLocaleUrl(locale, `/jotting/at-twenty-five`);
---

<Base title={t("navigation.home")} {locale}>
  <main class="flex flex-col gap-5 sm:gap-20 flex-grow">
    <header class="flex items-center justify-center flex-wrap-reverse grow-0.6">
      <figure class="hero about-photo-figure header-figure">
        <!-- simplified: single image file used site-wide -->
        <img src="/me.png" alt="Shiyu Wang" class="home-photo about-photo" loading="lazy" decoding="async" />
        <figcaption class="home-photo-caption about-photo-caption">At the Met, Oct 2025</figcaption>
      </figure>
    </header>

    <!-- generous spacer to keep the layout airy between the photo and the hero text -->
    <div class="spacious" aria-hidden="true"></div>

    {
      preface && (
        <section class="flex flex-col">
          {/* Lines 1–2: tagline (left) and date (right) as a compact unit with no blank line */}
          <div class="hero-lines">
            <!-- Line 1: Tagline (left-aligned) -->
            <article class="markdown hero-tagline">
              <Content />
            </article>

            <!-- Line 2: Date (right-aligned, same unit) -->
            <div class="preface-date">
              Nov 1, 2025
            </div>
          </div>

          <!-- CTA removed for localized homepages: show CTA only on the root `/` homepage -->
        </section>
      )
    }

    <!-- Heatmap removed per request: remove rectangular grid at bottom of home -->
  </main>
</Base>

<style>
  /* Photo caption + desktop offset for localized homepages */
  .about-photo-figure { overflow: visible; display:block; text-align:center; }
  .about-photo { display:block; margin:0 auto; will-change:transform; }
  .about-photo-caption { font-family: 'Cormorant Garamond', var(--font-body), serif; font-weight:400; font-size:16px; color:#444; text-align:center; margin-top:0.5rem; display:inline-block; will-change:transform; transform: translateY(-20px); }

  @media (min-width: 768px) {
    .about-photo { transform: translateY(-40px); }
  }
</style>
