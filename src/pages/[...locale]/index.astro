---
import { i18n } from "astro:config/client";
import { render, getCollection } from "astro:content";
import { getRelativeLocaleUrl } from "astro:i18n";
// ❌ import { Icon } from "astro-icon/components"; // 不再使用站点 logo
import Time from "$utils/time";
import Base from "$layouts/Base.astro";
import Heatmap from "$components/Heatmap.svelte";
import config from "$config";
import i18nit from "$i18n";

export async function getStaticPaths() {
  // Create path for each locale, omitting default locale from URL
  return i18n!.locales.map(locale => ({
    params: { locale: locale == i18n?.defaultLocale ? undefined : (locale as string) }
  }));
}

const { locale = i18n!.defaultLocale } = Astro.params;
const t = i18nit(locale);

// Preface（当前语言，按时间倒序）
const prefaces = (
  await getCollection("preface", preface => {
    const [language, id] = preface.id.split("/");
    preface.id = id;
    return language == locale;
  })
).sort((a, b) => b.data.timestamp.getTime() - a.data.timestamp.getTime());

// Notes removed from site — we no longer fetch the `note` collection for the homepage

// Jottings（已发布，当前语言）
const jottings = await getCollection("jotting", jotting => {
  const [language] = jotting.id.split("/");
  return !jotting.data.draft && language == locale;
});

const preface = prefaces[0];
const { Content } = preface ? await render(preface) : ({} as any);
---

<Base title={t("navigation.home")} {locale}>
  <main class="flex flex-col gap-5 sm:gap-20 flex-grow">
    <header class="flex items-center justify-center flex-wrap-reverse grow-0.6">
  {/* Personal photo: responsive WebP + PNG fallback; optimized variants live in /public */}
  <picture>
    <source type="image/webp" srcset="/me-960.webp 960w, /me-480.webp 480w" sizes="(max-width:640px) 88vw, 45vw" />
    <source type="image/png" srcset="/me-960.png 960w, /me-480.opt.png 480w" sizes="(max-width:640px) 88vw, 45vw" />
    <img src="/me-480.opt.png" alt="Shiyu Wang" class="home-photo" loading="lazy" decoding="async" />
  </picture>
      
      {/* ❌ 站点 Logo 已移除 */}
    </header>

    {
      preface && (
        <section class="flex flex-col">
          <article class="markdown hero-tagline">
            <Content />
          </article>
          <div class="preface-date self-end my-2">
            Nov 1, 2025
          </div>
        </section>
      )
    }

    <!-- Heatmap removed per request: remove rectangular grid at bottom of home -->
  </main>
</Base>
